/**
 * 숙원 웹사이트 - 문의 폼 데이터 처리를 위한 Google Apps Script
 * 
 * 사용 방법:
 * 1. Google 스프레드시트에서 [확장 프로그램 > Apps Script] 메뉴를 선택하여 스크립트 편집기를 엽니다.
 * 2. 아래 코드를 붙여넣고 저장합니다.
 * 3. [배포 > 새 배포] 메뉴를 선택합니다.
 * 4. 유형으로 '웹 앱'을 선택합니다.
 * 5. '웹 앱으로 액세스할 수 있는 사용자'를 '모든 사용자'로 설정합니다.
 * 6. '배포'를 클릭하고 생성된 URL을 복사합니다.
 * 7. script.js 파일의 scriptURL 변수에 이 URL을 입력합니다.
 */

// 스프레드시트 ID를 여기에 입력하세요 (URL에서 /d/ 다음, /edit 이전 부분)
const SPREADSHEET_ID = '1-XdLdhhcnL-4c0glaT-UyoCSGy-lS3tcMzbxD2m-J34U';
const SHEET_NAME = 'Sheet1'; // 데이터를 저장할 시트 이름

// 웹 앱으로 POST 요청을 처리하는 함수
function doPost(e) {
  try {
    // 요청 본문 파싱
    const data = JSON.parse(e.postData.contents);
    
    // 스프레드시트와 시트 열기
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    let sheet = ss.getSheetByName(SHEET_NAME);
    
    // 시트가 없으면 새로 생성
    if (!sheet) {
      sheet = ss.insertSheet(SHEET_NAME);
      
      // 헤더 행 추가
      sheet.appendRow([
        '타임스탬프', 
        '이름', 
        '이메일', 
        '연락처', 
        '문의 유형', 
        '문의 내용'
      ]);
      
      // 헤더 행 서식 설정
      sheet.getRange(1, 1, 1, 6).setFontWeight('bold').setBackground('#f3e9d2');
      sheet.setFrozenRows(1);
    }
    
    // 데이터 행 추가
    sheet.appendRow([
      new Date(data.timestamp), // 타임스탬프를 날짜 형식으로 변환
      data.name,
      data.email,
      data.phone,
      data.inquiryType,
      data.message
    ]);
    
    // 모든 열 자동 크기 조정
    sheet.autoResizeColumns(1, 6);
    
    // 성공 응답 반환
    return ContentService.createTextOutput(JSON.stringify({
      result: 'success',
      message: '문의가 성공적으로 기록되었습니다.'
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch (error) {
    // 오류 발생 시 에러 응답 반환
    return ContentService.createTextOutput(JSON.stringify({
      result: 'error',
      message: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

// 웹 앱으로 GET 요청을 처리하는 함수 (테스트용)
function doGet() {
  return ContentService.createTextOutput(JSON.stringify({
    result: 'success',
    message: '숙원 웹사이트 문의 폼 API가 정상적으로 작동 중입니다.'
  })).setMimeType(ContentService.MimeType.JSON);
} 